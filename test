#!/bin/bash

# Убедимся, что передано достаточное количество аргументов
if [ "$#" -lt 4 ]; then
    echo "Usage: $0 <number_of_requests> <concurrency> <output_file> <url1> [<url2> ... <urlN>]"
    exit 1
fi

# Число запросов
REQUESTS=$1

# Уровень параллелизма
CONCURRENCY=$2

# Файл для записи вывода
OUTPUT_FILE=$3

# Удаляем файл, если он существует
rm -f $OUTPUT_FILE

# Сдвигаем аргументы, чтобы в $@ остались только URL
shift 3

# Запуск Apache Bench для каждого URL
for URL in "$@"; do
    echo "Testing $URL" | tee -a $OUTPUT_FILE
    ab -n $REQUESTS -c $CONCURRENCY $URL | tee -a $OUTPUT_FILE
    echo "----------------------------------------" | tee -a $OUTPUT_FILE
done



# Копируем скрипт в контейнер
COPY ./load_test.sh /usr/local/bin/load_test.sh
