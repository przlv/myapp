from confluent_kafka import Producer
import time

# Настройки Kafka
kafka_config = {
    'bootstrap.servers': 'localhost:9092',  # Адрес Kafka брокера
    'security.protocol': 'SSL',             # Используем SSL для безопасного подключения
    'ssl.ca.location': '/path/to/ca.pem',   # Корневой сертификат
    'ssl.certificate.location': '/path/to/client_cert.pem',  # Клиентский сертификат
    'ssl.key.location': '/path/to/client_key.pem',           # Закрытый ключ
}

# Создаем продюсера
producer = Producer(kafka_config)

# Callback для обработки результатов отправки
def delivery_report(err, msg):
    if err is not None:
        print(f"Ошибка при отправке сообщения: {err}")
    else:
        print(f"Сообщение отправлено в {msg.topic()} [{msg.partition()}]")

# Функция отправки сообщения в топик
def send_message(topic, message):
    try:
        producer.produce(topic, message.encode('utf-8'), callback=delivery_report)
        producer.poll(1)  # Ожидаем завершения отправки
    except Exception as e:
        print(f"Ошибка: {e}")

if __name__ == "__main__":
    topic_name = "my_topic"

    # Пример отправки сообщений в цикле
    for i in range(10):
        message = f"Сообщение {i}"
        send_message(topic_name, message)
        time.sleep(1)

    # Завершаем работу продюсера
    producer.flush()
