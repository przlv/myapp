from line_profiler import LineProfiler

def profile(follow=[]):
    def inner(func):
        def profiled_func(*args, **kwargs):
            profiler = LineProfiler()
            profiler.add_function(func)
            for f in follow:
                profiler.add_function(f)
            profiler.enable_by_count()
            result = func(*args, **kwargs)
            profiler.disable_by_count()
            profiler.print_stats()
            return result
        return profiled_func
    return inner
