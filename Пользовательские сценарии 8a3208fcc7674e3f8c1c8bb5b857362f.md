# Пользовательские сценарии

## Шаблон сценария:

```
001. Загрузка некорректного Excel-файла
Пред: Пользователь авторизован, имеет права на загрузку
Шаги:
1. Переход в "Загрузка данных"
2. Выбор некорректного Excel-файла
3. Нажатие "Загрузить"
Ожид: Отклонение с сообщением об ошибке
Факт: Принятие файла, ошибка при обработке
Послед: Нарушение целостности БД, потеря времени
```

# Сценарии

```
001. Обработка нового Excel-файла с данными
Пред: Пользователь загрузил файл в систему, файл доступен для обработки
Шаги:
1. Пользователь инициирует обработку файла
2. Система получает файл для обработки
3. Система выполняет валидацию данных файла
4. Система проверяет корректность заполнения данных
5. При успешной проверке, система записывает данные в БД, создает необходимые сущности и сохраняет замеры (при необходимости)
6. Система уведомляет пользователя о результате обработки
Ожид: Успешная обработка файла, валидация данных, запись в БД и создание сущностей
Факт: Данные успешно обработаны, прошли валидацию, записаны в БД, созданы сущности и сохранены замеры
Послед: Новые данные доступны в системе для дальнейшего использования, пользователь получает подтверждение
```

```
002. Обработка повторно загруженного Excel-файла с новыми данными
Пред: Пользователь загрузил файл, содержащий как ранее загруженные, так и новые строки данных
Шаги:
1. Пользователь инициирует обработку файла
2. Система получает файл для обработки
3. Система выполняет валидацию всех данных файла
4. Система проверяет корректность заполнения данных
5. При успешной проверке, система записывает все данные в БД, включая дублирующиеся строки
6. Система сохраняет уникальное время записи для каждой строки
7. Система уведомляет пользователя о результате обработки
Ожид: Успешная обработка файла, валидация всех данных, запись в БД включая дубликаты
Факт: Все данные успешно обработаны, прошли валидацию и записаны в БД с уникальным временем записи
Послед: Новые и дублирующиеся данные доступны в системе, пользователь получает подтверждение. Периодический джоб будет чистить таблицы от дубликатов, оставляя самые свежие записи.
```

```
003. Обработка файла с неизвестным полем
Пред: Пользователь загрузил файл с данными, содержащий поле, которое неизвестно системе
Шаги:
1. Пользователь инициирует обработку файла
2. Система получает файл для обработки
3. Система выполняет валидацию данных файла
4. Система обнаруживает неизвестное поле в файле
5. Система прекращает обработку файла
6. Система генерирует сообщение об ошибке с указанием неизвестного поля
7. Система отображает сообщение об ошибке пользователю
Ожид: Отклонение файла и отображение ошибки с указанием неизвестного поля
Факт: Файл отклонен, обработка прервана, пользователю показано сообщение об ошибке
Послед: Данные не записаны в БД, пользователь информирован о необходимости проверить структуру файла и убедиться, что все поля соответствуют ожидаемому формату
```

```
004. Автоматическое создание новых сущностей при обработке файла
Пред: Пользователь загрузил файл с данными, содержащий ссылки на сущности, которых нет в системе
Шаги:
1. Пользователь инициирует обработку файла
2. Система получает файл для обработки
3. Система выполняет валидацию данных файла
4. Система обнаруживает ссылки на несуществующие сущности
5. Система автоматически создает новые сущности в БД
6. Система завершает обработку файла
7. Система уведомляет пользователя о результате обработки
Ожид: Автоматическое создание новых сущностей и успешная обработка файла
Факт: Новые сущности созданы, файл обработан, но есть высокий риск создания некорректных или дублирующих сущностей из-за опечаток или неточностей в исходном файле
Послед: Данные записаны в БД, включая новые сущности. Возможно появление неправильных или избыточных сущностей, что может привести к проблемам с целостностью и качеством данных в долгосрочной перспективе
```